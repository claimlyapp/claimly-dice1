<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Roller Pro - Casino Grade</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #fff; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; 
            overflow: hidden; 
            height: 100vh;
            perspective: 1200px;
        }
        #ui {
            position: absolute; top: 30px; left: 30px; z-index: 100;
            background: rgba(0,0,0,0.95); padding: 30px; border-radius: 25px;
            border: 3px solid #ffd700; backdrop-filter: blur(25px);
            box-shadow: 0 25px 50px rgba(255,215,0,0.4);
            max-width: 500px; max-height: 90vh; overflow-y: auto;
        }
        #title { 
            font-size: 2.5em; color: #ffd700; text-align: center; 
            margin-bottom: 20px; text-shadow: 0 0 25px #ffd700; 
        }
        .stats-panel { 
            background: rgba(0,255,136,0.15); border: 2px solid #00ff88; 
            padding: 18px; border-radius: 18px; margin-bottom: 20px; 
        }
        .high-score-panel { 
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,215,0,0.1)); 
            border: 3px solid #ffd700; padding: 20px; border-radius: 20px; margin-bottom: 20px;
            text-align: center; 
        }
        .stat-row { 
            display: flex; justify-content: space-between; margin: 8px 0; font-size: 16px; 
        }
        .stat-label { color: #ccc; }
        .stat-value { font-weight: bold; color: #fff; font-size: 18px; }
        .high-score-value { font-size: 20px; font-weight: 900; color: #ffd700; text-shadow: 0 0 10px #ffd700; }
        .new-record { animation: flash 0.8s infinite; }
        .profit-positive { color: #00ff88 !important; }
        .profit-negative { color: #ff4757 !important; }
        #balance { font-size: 32px; color: #00ff88; margin: 20px 0; text-align: center; text-shadow: 0 0 20px #00ff88; }
        .controls { 
            display: flex; gap: 12px; align-items: center; justify-content: center; 
            margin: 20px 0; flex-wrap: wrap; 
        }
        input, select, button { 
            padding: 15px 22px; font-size: 18px; border: 2px solid #ffd700; 
            background: rgba(0,0,0,0.9); color: #ffd700; border-radius: 15px;
            font-weight: bold; font-family: inherit; cursor: pointer; transition: all 0.3s;
        }
        input, select { width: 120px; }
        button { 
            background: linear-gradient(45deg, #ff6b35, #f7931e); border: none; color: white; 
            box-shadow: 0 8px 25px rgba(255,107,53,0.4);
        }
        button:hover:not(:disabled) { 
            transform: translateY(-3px) scale(1.05); box-shadow: 0 15px 35px rgba(255,107,53,0.6); 
        }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        #restart-btn { 
            background: linear-gradient(45deg, #667eea, #764ba2); width: 100%; 
            margin-top: 15px; padding: 18px; font-size: 20px;
        }
        #result { 
            font-size: 32px; font-weight: 900; text-align: center; margin: 25px 0;
            min-height: 50px; text-shadow: 0 0 25px currentColor; padding: 20px;
            background: rgba(0,0,0,0.6); border-radius: 20px; border: 2px solid transparent;
        }
        .win { color: #00ff88 !important; border-color: #00ff88; animation: pulse 1s infinite; }
        .lose { color: #ff4757 !important; border-color: #ff4757; animation: shake 0.6s ease-in-out; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
        @keyframes flash { 0%, 100% { background: rgba(255,215,0,0.4); } 50% { background: rgba(255,215,0,0.8); } }
        @keyframes roll3D {
            0% { transform: rotateX(0) rotateY(0) scale(1); }
            25% { transform: rotateX(360deg) rotateY(180deg) scale(1.1); }
            50% { transform: rotateX(720deg) rotateY(360deg) scale(0.95); }
            75% { transform: rotateX(1080deg) rotateY(540deg) scale(1.15); }
            100% { transform: rotateX(1440deg) rotateY(720deg) scale(1); }
        }
        .rolling { animation: roll3D 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        #canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100vh; }
        @media (max-width: 768px) { 
            #ui { left: 10px; right: 10px; top: 10px; padding: 20px; max-width: none; } 
            .controls { gap: 8px; }
            input, select, button { padding: 12px 16px; font-size: 16px; }
        }
    </style>
</head>
<body>
    <div id="ui">
        <div id="title">ðŸŽ² DICE ROLLER PRO</div>
        
        <!-- HIGH SCORES -->
        <div id="high-score-panel" class="high-score-panel">
            <div class="stat-row">
                <span class="stat-label">ðŸ’° Peak Balance</span>
                <span class="high-score-value" id="peak-balance">$10,000.00</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">ðŸ“ˆ Best Win Rate</span>
                <span class="high-score-value" id="best-winrate">0.0%</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">ðŸŽ¯ Best Session</span>
                <span class="high-score-value" id="best-session">$0.00</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">âš¡ Total Rolls</span>
                <span class="high-score-value" id="total-rolls">0</span>
            </div>
        </div>
        
        <!-- SESSION STATS -->
        <div id="session-stats" class="stats-panel">
            <div class="stat-row">
                <span class="stat-label">Wins:</span>
                <span class="stat-value" id="session-wins">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Losses:</span>
                <span class="stat-value" id="session-losses">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Win Rate:</span>
                <span class="stat-value" id="session-winrate">0.0%</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Session P&L:</span>
                <span class="stat-value" id="session-profit">$0.00</span>
            </div>
        </div>
        
        <div id="balance">$10,000.00</div>
        
        <div class="controls">
            <input type="number" id="bet-input" value="100" min="10" max="5000">
            <select id="multiplier">
                <option value="1.5">1.5x</option>
                <option value="2" selected>2x</option>
                <option value="3">3x</option>
                <option value="5">5x</option>
                <option value="10">10x</option>
            </select>
            <button id="roll-btn">ðŸŽ² ROLL</button>
            <button id="max-btn">MAX BET</button>
        </div>
        
        <div id="result">Ready to roll! ðŸŽ¯</div>
        <button id="restart-btn">ðŸ”„ NEW SESSION</button>
    </div>
    
    <canvas id="canvas"></canvas>

    <script>
        // FIXED HIGH SCORE MANAGER - NO ERRORS
        class HighScoreManager {
            constructor() {
                try {
                    const saved = localStorage.getItem('diceRollerPro_v2');
                    if (saved) {
                        const data = JSON.parse(saved);
                        this.peakBalance = data.peakBalance || 10000;
                        this.bestWinRate = data.bestWinRate || 0;
                        this.bestSession = data.bestSession || 0;
                        this.totalRolls = data.totalRolls || 0;
                    } else {
                        this.peakBalance = 10000;
                        this.bestWinRate = 0;
                        this.bestSession = 0;
                        this.totalRolls = 0;
                    }
                } catch (e) {
                    console.log('LocalStorage reset - starting fresh');
                    this.reset();
                }
            }
            
            reset() {
                this.peakBalance = 10000;
                this.bestWinRate = 0;
                this.bestSession = 0;
                this.totalRolls = 0;
            }
            
            save() {
                try {
                    const data = {
                        peakBalance: this.peakBalance,
                        bestWinRate: this.bestWinRate,
                        bestSession: this.bestSession,
                        totalRolls: this.totalRolls,
                        version: 'v2'
                    };
                    localStorage.setItem('diceRollerPro_v2', JSON.stringify(data));
                } catch (e) {
                    console.log('Save failed, continuing offline');
                }
            }
            
            updatePeakBalance(balance) {
                if (balance > this.peakBalance) {
                    this.peakBalance = balance;
                    document.getElementById('peak-balance').classList.add('new-record');
                    setTimeout(() => {
                        document.getElementById('peak-balance').classList.remove('new-record');
                    }, 3000);
                    this.save();
                    return true;
                }
                return false;
            }
            
            updateBestWinRate(winRate) {
                if (winRate > this.bestWinRate && winRate > 0) {
                    this.bestWinRate = winRate;
                    document.getElementById('best-winrate').classList.add('new-record');
                    setTimeout(() => {
                        document.getElementById('best-winrate').classList.remove('new-record');
                    }, 3000);
                    this.save();
                    return true;
                }
                return false;
            }
            
            updateBestSession(profit) {
                if (profit > this.bestSession) {
                    this.bestSession = profit;
                    document.getElementById('best-session').classList.add('new-record');
                    setTimeout(() => {
                        document.getElementById('best-session').classList.remove('new-record');
                    }, 3000);
                    this.save();
                    return true;
                }
                return false;
            }
            
            incrementRolls() {
                this.totalRolls++;
                this.save();
            }
        }

        // Initialize high scores
        const highScores = new HighScoreManager();
        
        // Game state
        let gameState = {
            balance: 10000,
            sessionWins: 0,
            sessionLosses: 0,
            sessionStartBalance: 10000,
            betAmount: 100,
            multiplier: 2,
            isRolling: false
        };

        // DOM elements
        const rollBtn = document.getElementById('roll-btn');
        const maxBtn = document.getElementById('max-btn');
        const restartBtn = document.getElementById('restart-btn');
        const betInput = document.getElementById('bet-input');
        const multiplierSelect = document.getElementById('multiplier');

        // Initialize game
        function init() {
            rollBtn.addEventListener('click', rollDice);
            maxBtn.addEventListener('click', maxBet);
            restartBtn.addEventListener('click', restartGame);
            betInput.addEventListener('input', updateBet);
            multiplierSelect.addEventListener('change', updateMultiplier);
            
            updateDisplay();
            startParticles();
            updateCanvasSize();
        }

        // Update display
        function updateDisplay() {
            document.getElementById('balance').textContent = `$${gameState.balance.toFixed(2)}`;
            document.getElementById('session-wins').textContent = gameState.sessionWins;
            document.getElementById('session-losses').textContent = gameState.sessionLosses;
            
            const totalRolls = gameState.sessionWins + gameState.sessionLosses;
            const winRate = totalRolls > 0 ? (gameState.sessionWins / totalRolls * 100) : 0;
            document.getElementById('session-winrate').textContent = winRate.toFixed(1) + '%';
            
            const profit = gameState.balance - gameState.sessionStartBalance;
            document.getElementById('session-profit').textContent = `$${profit.toFixed(2)}`;
            document.getElementById('session-profit').className = `stat-value ${profit >= 0 ? 'profit-positive' : 'profit-negative'}`;
            
            // High scores
            document.getElementById('peak-balance').textContent = `$${highScores.peakBalance.toFixed(2)}`;
            document.getElementById('best-winrate').textContent = highScores.bestWinRate.toFixed(1) + '%';
            document.getElementById('best-session').textContent = `$${highScores.bestSession.toFixed(2)}`;
            document.getElementById('total-rolls').textContent = highScores.totalRolls.toLocaleString();
        }

        // Roll dice
        function rollDice() {
            if (gameState.isRolling || gameState.betAmount > gameState.balance) return;
            
            highScores.incrementRolls();
            gameState.isRolling = true;
            rollBtn.disabled = true;
            gameState.balance -= gameState.betAmount;
            
            const resultEl = document.getElementById('result');
            const ui = document.getElementById('ui');
            ui.classList.add('rolling');
            resultEl.textContent = 'ðŸŽ² ROLLING...';
            resultEl.className = 'rolling';
            
            setTimeout(() => {
                const rollResult = (Math.random() * 100).toFixed(1);
                const winThreshold = 100 - (100 / gameState.multiplier);
                const won = parseFloat(rollResult) >= winThreshold;
                
                if (won) {
                    const payout = gameState.betAmount * gameState.multiplier;
                    gameState.balance += payout;
                    gameState.sessionWins++;
                    resultEl.innerHTML = `ðŸŽ‰ ${rollResult}/100 WIN! +$${payout.toFixed(0)}`;
                    resultEl.className = 'win';
                    highScores.updatePeakBalance(gameState.balance);
                } else {
                    gameState.sessionLosses++;
                    resultEl.innerHTML = `ðŸ’¥ ${rollResult}/100 LOSE -$${gameState.betAmount}`;
                    resultEl.className = 'lose';
                }
                
                const totalRolls = gameState.sessionWins + gameState.sessionLosses;
                if (totalRolls > 10) {
                    const winRate = gameState.sessionWins / totalRolls * 100;
                    highScores.updateBestWinRate(winRate);
                }
                
                const profit = gameState.balance - gameState.sessionStartBalance;
                highScores.updateBestSession(profit);
                
                updateDisplay();
                gameState.isRolling = false;
                rollBtn.disabled = false;
                ui.classList.remove('rolling');
            }, 1200);
        }

        // Utility functions
        function maxBet() {
            gameState.betAmount = Math.floor(gameState.balance * 0.1);
            betInput.value = gameState.betAmount;
        }

        function restartGame() {
            const profit = gameState.balance - gameState.sessionStartBalance;
            highScores.updateBestSession(Math.max(profit, highScores.bestSession));
            
            gameState = {
                balance: 10000,
                sessionWins: 0,
                sessionLosses: 0,
                sessionStartBalance: 10000,
                betAmount: 100,
                multiplier: 2,
                isRolling: false
            };
            
            document.getElementById('result').textContent = 'New session started! ðŸŽ¯';
            document.getElementById('result').className = '';
            betInput.value = 100;
            updateDisplay();
        }

        function updateBet() {
            gameState.betAmount = Math.max(10, Math.min(parseInt(betInput.value) || 100, gameState.balance));
            betInput.value = gameState.betAmount;
        }

        function updateMultiplier() {
            gameState.multiplier = parseFloat(multiplierSelect.value);
        }

        // Canvas particles
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        
        function startParticles() {
            for(let i = 0; i < 60; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.3,
                    vy: (Math.random() - 0.5) * 0.3,
                    size: Math.random() * 2 + 1
                });
            }
            animate();
        }
        
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                if(p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if(p.y < 0 || p.y > canvas.height) p.vy *= -1;
                
                ctx.save();
                ctx.globalAlpha = 0.7;
                ctx.fillStyle = '#ffd700';
                ctx.shadowColor = '#ffd700';
                ctx.shadowBlur = 8;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            });
            requestAnimationFrame(animate);
        }
        
        function updateCanvasSize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        // Event listeners
        window.addEventListener('resize', updateCanvasSize);
        document.addEventListener('keydown', (e) => {
            if(e.key === ' ') { e.preventDefault(); rollDice(); }
            if(e.key === 'Enter') maxBet();
            if(e.key.toLowerCase() === 'r') restartGame();
        });

        // Start game
        init();
    </script>
</body>
</html>
